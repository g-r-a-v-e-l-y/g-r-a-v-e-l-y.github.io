<!DOCTYPE html>
<html lang="en"  dir="auto" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Red teaming with EICAR - gimme pizza slow (high quality)</title>
<meta property="og:title" content="Red teaming with EICAR - gimme pizza slow (high quality)">
<link rel="stylesheet" href="/css/style.css?v=1734730330">
<script src="/js/scripts.js?v=1734730330"></script>
<meta name="description" content="{{ content|truncate(160) }}">
<link rel="canonical" href="https://www.gravely.pizza/red-teaming-with-eicar" />
<meta name="generator" content="Eleventy v2.0.1">
<link rel="icon" href="/favicon.ico" sizes="any">
<link rel="icon" href="/favicon.svg" type="image/svg+xml">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<link rel="manifest" href="/manifest.webmanifest">
<link rel="alternate" type="application/rss+xml"  title="gimme pizza slow (high quality) RSS feed (excerpts)" href="/excerpts.xml" />
<link rel="alternate" type="application/rss+xml"  title="gimme pizza slow (high quality) RSS feed (full articles)" href="/full.xml" />
<link rel="alternate" type="application/json" title="gimme pizza slow (high quality) JSON feed (excerpts)" href="/excerpts.json">
<link rel="alternate" type="application/json" title="gimme pizza slow (high quality) JSON feed (full articles)" href="/full.json">
<meta property="og:site_name" content="gimme pizza slow (high quality)" />
<meta property="og:title" content="">
<meta property="og:url" content="https://www.gravely.pizza/red-teaming-with-eicar.html">
<meta property="og:type" content="article">
<meta property="og:image" content="https://www.gravely.pizza/images/share-1200x600.jpg">
<meta property="article:published_time" content="2009-09-05T18:35:00.000Z" />
<meta property="article:modified_time" content="2009-09-05T18:35:00.000Z" />
<meta property="twitter:image" content="https://www.gravely.pizza/images/share-1200x600.jpg">
<meta property="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@your_twitter_handle" />
<meta name="fediverse:creator" content="@gravely@mastodon.social" />
<link rel="me" href="https://mastodon.social/@gravely" title="@gravely@mastodon.social" />

<script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Article",
        "headline": "Red teaming with EICAR",
        "image": ["https://www.gravely.pizza/images/share-1200x600.jpg"],
        "author": {
            "@type": "Person",
            "name": "gravely"
        },
        "mainEntityOfPage": "https://www.gravely.pizza/red-teaming-with-eicar.html",
        "datePublished": "2011-10-09T03:43:00.000Z",
        "description": "{{ content|truncate(160) }}"
    }
</script>


  </head>
  <body>
    <a href="#main" id="skipToMain" class="skip-link">Skip to main content</a>
<header class="header">
  <input class="menu-btn" type="checkbox" id="menu-btn">
<label class="hamburger" tabindex="0" for="menu-btn">
  <span></span>
</label>
  <div class="main-nav">
  <ul class="site-links">
  
  <li>
    <a href="/">
      About
    </a>
  </li>
  
  <li>
    <a href="/blog.html">
      Blog
    </a>
  </li>
  
  <li>
    <a href="/links/">
      Links
    </a>
  </li>
  
  <li>
    <a href="/my-archives/">
      Archive
    </a>
  </li>
  
  <li>
    <a href="/favorites/">
      Favorites
    </a>
  </li>
  
  <li>
    <a href="/subscribe/">
      Subscribe
    </a>
  </li>
  
  <li class="theme-switcher">
    <a href=""><svg class="dark-toggle" viewBox="0 0 455 455" xmlns="http://www.w3.org/2000/svg">
<title>Dark mode switch icon</title>
<polygon points="320.18 162.7 280.63 171.05 307.72 201.05 303.44 241.24 340.34 224.75 377.24 241.24 372.96 201.05 400.05 171.05 360.5 162.7 340.34 127.67"/>
<polygon points="440 325.68 414.09 320.21 400.88 297.25 387.68 320.21 361.77 325.68 379.51 345.33 376.71 371.66 400.88 360.86 425.06 371.66 422.25 345.33"/>
<path d="m218 227.5c0-89.167 51.306-166.34 126-203.64-30.557-15.26-65.022-23.86-101.5-23.86-125.64 0-227.5 101.86-227.5 227.5s101.86 227.5 227.5 227.5c36.478 0 70.943-8.6 101.5-23.86-74.694-37.302-126-114.47-126-203.64z"/>
</svg>

  <svg class="light-toggle" viewBox="0 0 612 612" xmlns="http://www.w3.org/2000/svg"><title>Light mode switch icon</title><path d="m306 149.34c-86.382 0-156.66 70.278-156.66 156.66 0 86.382 70.278 156.66 156.66 156.66s156.66-70.278 156.66-156.66c0-86.384-70.278-156.66-156.66-156.66z"/><path d="m274.19 117.28h63.612c5.032 0 9.356-2.101 11.863-5.763 2.508-3.662 2.9-8.453 1.079-13.146l-34.999-90.112c-2.789-7.184-7.305-8.256-9.749-8.256s-6.96 1.073-9.749 8.255l-35 90.114c-1.821 4.692-1.427 9.482 1.079 13.145 2.507 3.663 6.832 5.763 11.864 5.763z"/><path d="m337.81 494.72h-63.612c-5.032 0-9.357 2.102-11.863 5.764-2.506 3.663-2.9 8.453-1.079 13.145l34.999 90.114c2.789 7.182 7.305 8.254 9.749 8.254s6.96-1.072 9.749-8.254l34.999-90.115c1.821-4.69 1.429-9.48-1.079-13.144-2.507-3.662-6.831-5.764-11.863-5.764z"/><path d="m127.54 190.82c2.412 5.477 7.028 8.746 12.348 8.746 3.644 0 7.257-1.608 10.174-4.526l44.981-44.98c3.558-3.558 5.13-8.102 4.312-12.466-0.819-4.362-3.928-8.028-8.532-10.056l-88.467-38.973c-2.233-0.983-4.336-1.482-6.25-1.482-3.201 0-5.959 1.415-7.568 3.882-1.357 2.081-2.454 5.747 0.031 11.389l38.971 88.466z"/><path d="m484.46 421.18c-2.412-5.477-7.027-8.746-12.346-8.746-3.645 0-7.259 1.609-10.177 4.527l-44.981 44.98c-3.558 3.559-5.13 8.104-4.312 12.466s3.929 8.028 8.532 10.055l88.466 38.974c2.233 0.983 4.336 1.482 6.25 1.482 3.201 0 5.959-1.417 7.568-3.882 1.358-2.083 2.455-5.748-0.03-11.389l-38.97-88.467z"/><path d="m461.94 195.04c2.918 2.918 6.532 4.526 10.176 4.526 5.319 0 9.934-3.269 12.348-8.746l38.972-88.465c2.486-5.643 1.389-9.308 0.031-11.389-1.609-2.467-4.367-3.882-7.568-3.882-1.914 0-4.017 0.499-6.251 1.483l-88.466 38.97c-4.604 2.029-7.715 5.694-8.532 10.057-0.818 4.363 0.754 8.908 4.312 12.466l44.978 44.98z"/><path d="m150.06 416.96c-2.918-2.918-6.532-4.527-10.177-4.527-5.319 0-9.934 3.269-12.346 8.746l-38.972 88.465c-2.486 5.643-1.389 9.308-0.031 11.39 1.609 2.466 4.368 3.882 7.568 3.882 1.914 0 4.017-0.499 6.251-1.484l88.466-38.972c4.604-2.028 7.715-5.694 8.532-10.056 0.818-4.362-0.753-8.907-4.312-12.466l-44.979-44.978z"/><path d="m603.74 296.25-90.111-34.996c-1.942-0.755-3.896-1.137-5.806-1.137-7.593 0-13.104 5.921-13.104 14.078l1e-3 63.613c0 8.157 5.511 14.078 13.104 14.078 1.912 0 3.866-0.382 5.806-1.136l90.112-34.999c7.182-2.79 8.254-7.306 8.254-9.751 0-2.443-1.075-6.961-8.256-9.75z"/><path d="m104.17 351.89c7.594 0 13.106-5.921 13.106-14.078v-63.613c0-8.157-5.511-14.078-13.106-14.078-1.912 0-3.864 0.382-5.805 1.136l-90.113 34.998c-7.182 2.789-8.255 7.305-8.255 9.75 0 2.444 1.072 6.96 8.255 9.752l90.111 34.996c1.942 0.754 3.895 1.137 5.807 1.137z"/></svg></a>
  </li>
  </ul>
  <div class="site-logo">
    <a href="/" title="gimme pizza slow (high quality) - Main page">
      
  <span class="site_title">gimme pizza slow (high quality)</span>

    </a>
  </div>
</div>

</header>

    <div id="main" class="container">
      

<div class="reading-progress-bar"></div>


<article class="single-article">

  

  <header>
    <h1>Red teaming with EICAR</h1>
  </header>
  <div class="top-meta">
  <time>5 Sep 2009</time>
  
  <span class="separator">, </span>
  <span data-tooltip="668 words" class="tooltip-bottom reading-time">4 min read</span>
  
</div>
  
  <p>Testing antivirus software with EICAR<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup> deletions one virus at a time is effective but one dimensional. Successful deletion of a single EICAR string validates antivirus software for a given system, in a given directory, at the rate of one virus per unit of time. But single EICAR string deletions do nothing to stress secondary system alerting capabilities, validate rate limiting rules, enumerate directory level exclusions, validate reactive policy changes, and so on.</p>
<h3 id="weaponizing-eicar">Weaponizing EICAR</h3>
<p>It looks so innocent doesn’t it?</p>
<p><code>X5O!P%@AP[4\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*</code></p>
<p>That later group all seem like fun, useful-to-have validation capabilities, so with them in mind, I wrote eicar based malware for a red team drill, leveraging EICAR to enumerate directory level antivirus exclusions.</p>
<p>The attack I wrote for the drill skipped system compromise. Sorry breakers, I was more interested in detection depth, breadth, and speed for this drill.</p>
<p>The components of this attack were designed to replicate real world attacker techniques, while avoiding real world obfuscation techniques that would turn this drill into a <em>receive alert &amp; down the host</em> drill.</p>
<h3 id="a-few-simple-subroutines">A few simple subroutines</h3>
<ul>
<li>DNS command and control – Every few minutes, interrogate a public internet DNS server for an A record. This hostname was under my control, and returned a resource record pointing to 127.0.0.1. If this changes to anything else, proceed to…</li>
<li>EICAR antivirus directory level exclusion enumeration – start at the root of C:\ and interrogate every listing found. If it is a directory, drop an EICAR file in it. Immediately interrogate the EICAR file. If it still exists, push the directory name into the <em>findings</em> array.</li>
<li>After enumerating all of the directory level exclusions, choose one at random and download more reconnaissance tools from internet servers. This is a drill, download lots.</li>
<li><strike>Go nuts with all of your silly tools.</strike></li>
</ul>
<p>Don’t go crazy with tools. Don’t go crazy with tools. Don’t go crazy with tools. Don’t go crazy with tools. Don’t go crazy with tools. <em>Don’t go crazy with tools.</em></p>
<h3 id="what-happened">What happened?</h3>
<p>I’m not going to tell you.</p>
<h3 id="why-drill-like-this">Why drill like this?</h3>
<p>Each subroutine increases the time-to-response requirements. The DNS subroutine could run for days, the EICAR test will interrogate a full system in minutes, tools can be downloaded in seconds.</p>
<p>Each subroutine highlights disparate detection technologies, placement, logging, and so on. EICAR throws incident responder assumptions because it is very much an infrastructure testing tool and not malware.</p>
<h3 id="spray-eicar">spray-eicar</h3>
<p>I’ve ripped out all the command and control and tool downloads. Sorry, it was rubbish anyway and you can do better.</p>
<p>But you can have the perl that can be compiled with perl2exe sort of tools, I’ve posted it on github as <a href="http://github.com/grantstavely/spray-eicar/tree/master">spray-eicar</a>.</p>
<h3 id="weaponizing-eicar-1">Weaponizing EICAR?</h3>
<p>OK, maybe it isn’t actually weaponizing EICAR. What else could be done with this trick?</p>
<ul>
<li>Enumerate file level antivirus exclusions: Find .exe file -&gt; determine if it is an active process -&gt; move it to $filename.bak -&gt; drop EICAR -&gt; undo.</li>
<li>DDOS secondary alerting systems: Execute spray-eicar enterprise wide on all desktops. Ouch. Can your antivirus product whitelist EICAR even if you want it to?</li>
<li>Stop at the first finding. Pull and run tools. Obviously.</li>
<li>Stop at the first subroutine and then propagate to enumerate policy homogeneity.</li>
</ul>
<p>And so on.</p>
<hr class="footnotes-sep">
<section class="footnotes">
<ol class="footnotes-list">
<li id="fn1" class="footnote-item"><p>The <strong>EICAR test file</strong> (official name: <strong>EICAR Standard Anti-Virus Test File</strong>) is a file, developed by the <a href="http://wikipedia.org/wiki/EICAR">European Institute for Computer Antivirus Research</a>, to test the response of computer <a href="http://wikipedia.org/wiki/Antivirus">antivirus</a> (AV) programs. The rationale behind it is to allow people, companies, and AV programmers to test their software without having to use a real <a href="http://wikipedia.org/wiki/Computer_virus">computer virus</a> that could cause actual damage should the AV not respond correctly. EICAR likens the use of a live virus to test AV software to setting a fire in a trashcan to test a fire alarm, and promotes the EICAR test file as a safe alternative. <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</li>
</ol>
</section>

</article>

<div class="post-navigation">
  <ul>
    <li>
      
      <a href="/what-i-expect-inside-inside-files-with-underscores-in-the-name-instead-of-spaces.html">
        <span class="headline">← Newer article</span>
        <span class="title">What I expect inside inside files with underscores in the name instead of spaces...</span>
      </a>
      
    </li>
    <li>
      
      <a href="/the-shortened-url-straw-men-of-doom.html">
        <span class="headline">Older article →</span>
        <span class="title">The shortened url straw men of doom</span>
      </a>
      
    </li>
  </ul>
</div>

<div class="scroll-up-arrow" tabindex="0">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><g><path class="fillable" d="M990,699.9c0,8.1,0,16.3-8.1,24.4c-16.3,16.3-40.7,16.3-56.9,0L502,350.2L79.1,732.4c-16.3,16.3-40.7,16.3-56.9,0c-16.3-16.3-16.3-40.7,0-56.9l447.3-406.6c24.4-16.3,40.7-16.3,56.9-8.1l447.3,406.6C981.9,675.5,990,691.8,990,699.9z"></path></g></svg>

</div>

      <footer class="footer">
  <div class="container">
    <div class="links">
  
<ul>

</ul>

</div>
    <div class="copyright">
  &copy; 1999-2024 <a href="https://www.gravely.pizza/">gravely</a>
</div>
  </div>
</footer>

    </div>
  </body>
</html>